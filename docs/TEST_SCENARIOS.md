# Тестовые сценарии для gamesCheck

> **Версия:** 1.0  
> **Для:** TestFlight тестирование  
> **Дата:** 2026-01-30

---

## Сценарий 1: Первый запуск и регистрация

**Цель:** Проверить first-time user experience

**Предусловия:**
- Приложение установлено из TestFlight
- Приложение не запускалось ранее

**Шаги:**

1. Открыть приложение первый раз
2. Увидеть welcome screen или login screen
3. Нажать "Зарегистрироваться"
4. Ввести username: `testuser1`
5. Ввести password: `Test123456!`
6. Нажать "Создать аккаунт"
7. Разрешить push-уведомления (если запрос появился)
8. Перейти на главный экран

**Ожидаемый результат:**
- Регистрация успешна
- Токен сохранён в Keychain
- Главный экран отображается
- Нет ошибок

**Проверки:**
- [ ] Welcome screen отображается корректно
- [ ] Валидация полей работает
- [ ] Кнопка "Создать аккаунт" активна после ввода данных
- [ ] Индикатор загрузки показывается во время регистрации
- [ ] После регистрации пользователь залогинен

---

## Сценарий 2: Создание первой игры

**Цель:** Проверить базовый flow создания игры

**Предусловия:**
- Пользователь залогинен
- Игр пока нет

**Шаги:**

1. Нажать кнопку "Новая игра" или "+"
2. Выбрать тип игры: "Poker"
3. Добавить игрока 1:
   - Имя: "Алексей"
   - Buyin: 100
   - Cashout: 150
4. Добавить игрока 2:
   - Имя: "Мария"
   - Buyin: 100
   - Cashout: 80
5. Добавить игрока 3:
   - Имя: "Иван"
   - Buyin: 100
   - Cashout: 120
6. Добавить игрока 4:
   - Имя: "Ольга"
   - Buyin: 100
   - Cashout: 50
7. Добавить заметку: "Домашняя игра - первая сессия"
8. Нажать "Сохранить"

**Ожидаемый результат:**
- Игра создана
- Сумма buyins (400) = сумма cashouts (400)
- Игра отображается в списке
- Статистика обновилась

**Проверки:**
- [ ] Форма добавления игрока интуитивна
- [ ] Валидация: buyin и cashout не могут быть отрицательными
- [ ] Валидация: сумма buyins должна равняться сумме cashouts
- [ ] Автосохранение работает (если реализовано)
- [ ] После сохранения возврат к списку игр

---

## Сценарий 3: CloudKit синхронизация между устройствами

**Цель:** Проверить основную фичу - синхронизацию

**Предусловия:**
- Устройство 1: testuser1 залогинен
- Устройство 2: testuser2 залогинен
- Оба устройства онлайн

**Шаги:**

**На Устройстве 1:**
1. Создать игру "Sync Test 1"
2. Добавить 3 игроков:
   - Player1: buyin=50, cashout=100
   - Player2: buyin=50, cashout=30
   - Player3: buyin=50, cashout=20
3. Сохранить
4. Подождать 10 секунд

**На Устройстве 2:**
5. Перезапустить приложение (force close + open)
6. Обновить список игр (pull to refresh)
7. Проверить, появилась ли игра "Sync Test 1"
8. Открыть игру
9. Проверить всех игроков и суммы

**Ожидаемый результат:**
- Игра синхронизировалась в CloudKit
- На Устройстве 2 игра видна
- Все данные корректны

**Проверки:**
- [ ] Синхронизация произошла за < 30 секунд
- [ ] Все поля игры совпадают (название, игроки, суммы, заметки)
- [ ] Нет дублирования игроков
- [ ] Timestamp игры корректен

---

## Сценарий 4: Оффлайн создание и синхронизация

**Цель:** Проверить offline-first approach

**Предусловия:**
- Пользователь залогинен
- Устройство онлайн изначально

**Шаги:**

1. Включить Airplane Mode (или отключить Wi-Fi)
2. Создать игру "Offline Game"
3. Добавить 2 игроков:
   - Alice: buyin=200, cashout=300
   - Bob: buyin=200, cashout=100
4. Сохранить игру
5. Проверить, что игра появилась в списке
6. Выключить Airplane Mode
7. Подождать 20 секунд
8. На другом устройстве обновить список

**Ожидаемый результат:**
- Игра сохранилась локально в CoreData
- После включения интернета синхронизировалась в CloudKit
- На другом устройстве игра появилась

**Проверки:**
- [ ] Приложение работает без краша оффлайн
- [ ] Индикатор оффлайн режима (если есть)
- [ ] После восстановления связи автосинхронизация
- [ ] Нет потери данных

---

## Сценарий 5: Конфликт синхронизации

**Цель:** Проверить conflict resolution

**Предусловия:**
- Игра "Conflict Test" существует на обоих устройствах
- Оба устройства онлайн

**Шаги:**

**На Устройстве 1:**
1. Включить Airplane Mode
2. Открыть игру "Conflict Test"
3. Изменить заметку на "Modified on Device 1"
4. Сохранить

**На Устройстве 2:**
5. Включить Airplane Mode
6. Открыть ту же игру "Conflict Test"
7. Изменить заметку на "Modified on Device 2"
8. Сохранить

**На обоих устройствах:**
9. Выключить Airplane Mode
10. Подождать 30 секунд
11. Проверить, какая заметка осталась

**Ожидаемый результат:**
- Приложение не крашится
- Конфликт разрешился автоматически
- Выбрана одна из версий (обычно последняя по timestamp)

**Проверки:**
- [ ] Нет краша при конфликте
- [ ] Данные не потерялись
- [ ] Пользователь получил уведомление (если реализовано)
- [ ] Логи содержат информацию о конфликте

---

## Сценарий 6: Push-уведомления

**Цель:** Проверить доставку уведомлений

**Предусловия:**
- Push-уведомления разрешены на обоих устройствах
- Оба пользователя залогинены

**Шаги:**

**На Устройстве 1:**
1. Создать новую публичную игру "Push Test"
2. Сохранить

**На Устройстве 2:**
3. Свернуть приложение (home button)
4. Подождать 10-30 секунд
5. Проверить, пришло ли push-уведомление
6. Tap на уведомление

**Ожидаемый результат:**
- Push-уведомление доставлено
- Заголовок и текст корректны
- Tap открывает приложение и показывает игру

**Проверки:**
- [ ] Уведомление приходит за < 30 секунд
- [ ] Текст уведомления понятен
- [ ] Звук/вибрация (если включены)
- [ ] Badge icon обновляется
- [ ] Deep link работает при tap

---

## Сценарий 7: Заявки на игроков (Player Claims)

**Цель:** Проверить flow заявок

**Предусловия:**
- testuser1 создал игру с игроком "Unknown"
- testuser2 хочет заявить, что это он

**Шаги:**

**testuser1 (Устройство 1):**
1. Создать игру с игроком "Unknown Player"
2. Сохранить

**testuser2 (Устройство 2):**
3. Увидеть игру testuser1 (после синхронизации)
4. Открыть раздел "Мои заявки" (My Claims)
5. Нажать "Создать заявку"
6. Выбрать игрока "Unknown Player"
7. Отправить заявку

**testuser1 (Устройство 1):**
8. Перейти в "Ожидающие заявки" (Pending Claims)
9. Увидеть заявку от testuser2
10. Нажать "Одобрить" (Approve)

**testuser2 (Устройство 2):**
11. Обновить список заявок
12. Статус изменился на "Approved"

**Ожидаемый результат:**
- Заявка создана и синхронизирована
- testuser1 видит заявку
- После одобрения статус обновился
- Профиль игрока обновился

**Проверки:**
- [ ] UI для создания заявки интуитивен
- [ ] Статусы синхронизируются
- [ ] Push-уведомление о решении (если реализовано)
- [ ] Профиль игрока корректно обновился

---

## Сценарий 8: Статистика и отчёты

**Цель:** Проверить корректность расчётов

**Предусловия:**
- Пользователь создал 5 игр
- У пользователя есть профиль

**Шаги:**

1. Открыть вкладку "Статистика"
2. Проверить общий баланс
3. Проверить количество игр
4. Открыть график buyins/cashouts
5. Проверить win rate
6. Открыть детальную статистику по игроку

**Ожидаемый результат:**
- Все метрики корректны
- График отображается правильно
- Данные соответствуют реальным играм

**Проверки:**
- [ ] Баланс = сумма всех (cashouts - buyins)
- [ ] Количество игр совпадает
- [ ] График интерактивен (если реализовано)
- [ ] Win rate рассчитан правильно
- [ ] Нет division by zero ошибок

---

## Сценарий 9: Большой объём данных

**Цель:** Проверить производительность

**Предусловия:**
- Пользователь залогинен

**Шаги:**

1. Создать 50 игр с разными датами
2. Добавить 20 уникальных игроков
3. Открыть список игр
4. Scroll down до конца списка
5. Scroll up обратно
6. Открыть статистику
7. Проверить memory usage в Xcode

**Ожидаемый результат:**
- Scrolling плавный (60 FPS)
- Нет лагов при открытии списка
- Memory usage < 150MB
- Загрузка быстрая

**Проверки:**
- [ ] LazyVStack работает (ленивая загрузка)
- [ ] Images кэшируются
- [ ] Pagination работает (если реализована)
- [ ] Нет memory leaks

---

## Сценарий 10: Poker Odds Calculator

**Цель:** Проверить специфичную фичу

**Предусловия:**
- Пользователь залогинен

**Шаги:**

1. Открыть Poker Odds Calculator
2. Выбрать pocket cards: A♠ K♠
3. Добавить flop: A♦ K♥ 2♣
4. Установить количество оппонентов: 2
5. Нажать "Calculate"
6. Проверить результат

**Ожидаемый результат:**
- Расчёты корректны
- UI отзывчив
- Результаты отображаются понятно

**Проверки:**
- [ ] Калькулятор загружается быстро
- [ ] Выбор карт удобен
- [ ] Расчёты математически верны
- [ ] Можно сбросить и пересчитать

---

## Сценарий 11: Регрессия после обновления

**Цель:** Проверить миграцию данных

**Предусловия:**
- Старый билд установлен
- Есть тестовые данные (5+ игр)

**Шаги:**

1. Запомнить количество игр и баланс
2. Скриншот списка игр
3. Обновить приложение из TestFlight (новый билд)
4. Открыть приложение
5. Проверить, что все данные на месте
6. Сравнить со скриншотом

**Ожидаемый результат:**
- Все данные сохранились
- CoreData миграция успешна
- Нет потери информации

**Проверки:**
- [ ] Количество игр совпадает
- [ ] Баланс не изменился
- [ ] Все игроки на месте
- [ ] Настройки сохранились

---

## Сценарий 12: Чистая установка и восстановление

**Цель:** Проверить CloudKit восстановление

**Предусловия:**
- testuser1 имеет данные в CloudKit (5+ игр)

**Шаги:**

1. Удалить приложение полностью (long press → delete)
2. Установить заново из TestFlight
3. Открыть приложение
4. Залогиниться как testuser1
5. Подождать загрузки данных из CloudKit
6. Проверить список игр

**Ожидаемый результат:**
- Все игры восстановились из CloudKit
- Профили игроков на месте
- Статистика корректна

**Проверки:**
- [ ] Данные загрузились автоматически
- [ ] Индикатор загрузки показывается
- [ ] Все записи восстановлены
- [ ] Нет дублирования

---

## Сценарий 13: Некорректные данные

**Цель:** Проверить валидацию

**Шаги:**

1. Попытаться создать игру с buyin = -100
2. Попытаться создать игру с пустым именем игрока
3. Попытаться создать игру без игроков
4. Попытаться создать игру с несбалансированными суммами:
   - Player1: buyin=100, cashout=200
   - Player2: buyin=100, cashout=50
   - Сумма buyins (200) ≠ сумма cashouts (250)

**Ожидаемый результат:**
- Валидация предотвращает сохранение
- Понятные сообщения об ошибках
- UI подсвечивает некорректные поля

**Проверки:**
- [ ] Нельзя ввести отрицательные числа
- [ ] Кнопка "Сохранить" неактивна при ошибках
- [ ] Error messages понятны
- [ ] Валидация в реальном времени

---

## Итоговая оценка тестирования

После выполнения всех сценариев заполните:

### Пройденные сценарии

- [ ] Сценарий 1: Регистрация
- [ ] Сценарий 2: Создание игры
- [ ] Сценарий 3: CloudKit синхронизация
- [ ] Сценарий 4: Оффлайн режим
- [ ] Сценарий 5: Конфликты
- [ ] Сценарий 6: Push-уведомления
- [ ] Сценарий 7: Player Claims
- [ ] Сценарий 8: Статистика
- [ ] Сценарий 9: Производительность
- [ ] Сценарий 10: Poker Odds
- [ ] Сценарий 11: Регрессия
- [ ] Сценарий 12: Восстановление
- [ ] Сценарий 13: Валидация

### Найденные баги

**Критические:** _______  
**Средние:** _______  
**Низкие:** _______

### Общая оценка

**Готовность к Production:** _____ / 10

---

**Дата тестирования:** _______________  
**Тестировщик:** _______________  
**Билд version:** _______________
